<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Consumer Group Story</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/reset.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.8.0/css/reveal.min.css">
    <link rel="stylesheet" href="./dist/theme/mine.css" id="theme">
    <link href="custom.css" rel="stylesheet">

</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-markdown data-separator="---" data-separator-vertical="^\n--\n$">
            <script type="text/template">

# Multi-Tenancy & Kafka
## April 2023
## Devoxx*FR*

--

<!--.slide: data-state="black-bg" -->
# Speakers

--

# *Florent*
# Ex Confluent
# *Conduktor*
# Geek
# *@framiere*

--

<img style="float: right" class="r-stretch" src="img/fteychene_bio.jpg" />

# *François*
# Ex Elastic/StarTree
# *Conduktor*
# Über Geek
# *@fteychene*


---

# Kafka is awesome ❤️️

--

![Kafka everywhere](img/kafka_everywhere.jpg)

--

<!-- .slide: class="center" -->
## But ...


# You want <!-- .element: class="fragment" data-fragment-index="1" --> **more** <!-- .element: class="fragment" data-fragment-index="1" -->

![MOAR](img/more.gif) <!-- .element: class="fragment" data-fragment-index="1" -->

---

<!--.slide: data-state="black-bg" -->

# Multi-tenancy

--

<!--.slide: data-state="black-bg" -->
# Chat GPT is the new Wikipedia

--

### Multi-tenancy is a *software architecture* in which a single instance of an application serves multiple customers, known as tenants. 
### Each tenant has its own *isolated data* and configuration, but *shares* the same infrastructure.
### However, it also requires careful design and implementation to ensure that data is *properly* secured and isolated between tenants.

--

# *Meh*, we're not any further ahead

--

# Let's talk about the *pains* then

--

# Multi-tenancy is for
# either *large enterprises*
# or *compliance*

--

# We seem to be at *loss*...

---

<!--.slide: data-state="black-bg" -->
# Back to *Kafka*

--

# Kafka is *awesome* 
# *... but* <!-- .element: class="fragment" -->
# Houston we have a problem <!-- .element: class="fragment" -->

--

# s/problem/*problems*/

--

# Problem *#1*
# *Multiple Teams*

--

# Per Projects
# *Per Partners* <!-- .element: class="fragment" -->
# Per Business Units <!-- .element: class="fragment" -->
# *Per Software Vendors* <!-- .element: class="fragment" -->

--

# Problem *#2*
# *Multiple Environments*

--

# Dev
# *PreProd* <!-- .element: class="fragment" -->
# UAT <!-- .element: class="fragment" -->
# *Prod* <!-- .element: class="fragment" -->

--

# Problem #*3*
# *Multiple Clients* 

--

# Java
# *C#* <!-- .element: class="fragment" -->
# TypeScript <!-- .element: class="fragment" -->
# *Rust* <!-- .element: class="fragment" -->

--

# Problem *#3.5*
# Multiple *UIs*

--

# CLI
# *AKHQ* <!-- .element: class="fragment" -->
# CCloud <!-- .element: class="fragment" -->
# *Conduktor* <!-- .element: class="fragment" -->

--

# Problem *#4*
# *Multiple Requirements*

--

# Perf
# *Retention* <!-- .element: class="fragment" -->
# Msg Size <!-- .element: class="fragment" -->
# *Encryption* <!-- .element: class="fragment" -->

--

# Problem *#5*
# *Multiple Security Schemes*

--

# Open Bar
# *OAuth* <!-- .element: class="fragment" -->
# TLS <!-- .element: class="fragment" -->
# *Kerberos* <!-- .element: class="fragment" -->

--

# Problem *#6*
# *Multiple Kafka Providers*

--

# Kafka
# *MSK IAM* <!-- .element: class="fragment" -->
# Confluent Rbac <!-- .element: class="fragment" -->
# *RedPanda WASM* <!-- .element: class="fragment" -->

--

# Problem *#7*
# *Multiple Versions*

--

# 1.x
# *2.x* <!-- .element: class="fragment" -->
# 3.x <!-- .element: class="fragment" -->
# *Kafka "compatible"* <!-- .element: class="fragment" -->

--

# Problem *#8*
# *Multiple Monitoring*

--

# Kafka JMX
# *MSK* <!-- .element: class="fragment" -->
# Confluent API <!-- .element: class="fragment" -->
# *RedPanda* <!-- .element: class="fragment" -->

--

# Problem *#9*
# *Multiple Cost Structure*

--

# Free
# *Per Cluster* <!-- .element: class="fragment" -->
# Per Broker <!-- .element: class="fragment" -->
# *Per Usage* <!-- .element: class="fragment" -->

--

# Problem *#10*
# *Multiple Team Maturies*

--

# Newbie
# *Experienced* <!-- .element: class="fragment" -->
# Geeks <!-- .element: class="fragment" -->
# *Wrong tech* <!-- .element: class="fragment" -->

--

# Problem *#11*
# *Multiple GitOPS*

--

# Handmade
# *ns4Kafka* <!-- .element: class="fragment" -->
# JulieOps <!-- .element: class="fragment" -->
# *Software Vendor* <!-- .element: class="fragment" -->

--

# Ok we get it *...*

---

<!--.slide: data-state="black-bg" -->
# Now, *merge* multi-tenancy

<iframe src="https://giphy.com/embed/cFkiFMDg3iFoI" width="480" height="269" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>

--

> Multi-tenancy is a *software architecture* in which a single instance of an application serves multiple customers, known as tenants. 

*Thanks ChatGPT*

--

# What is a **tenant** in Kafka ?

--

# A tenant is the smallest unit of isolation you want to apply based on your organisation
Conway's law, yada yada

--

<!-- .slide: class="center" -->
## **Isolation for ?**
### Data <!-- .element: class="fragment" -->
### Constraints <!-- .element: class="fragment" -->
### Practice enforcement <!-- .element: class="fragment" -->
### Cost <!-- .element: class="fragment" -->
### ... <!-- .element: class="fragment" -->

--

<!-- .slide: class="center" -->
# Adapt and optimize Kafka to your organization

--- 

<!--.slide: data-state="black-bg" class="center" -->
# Our use-case : **Conduktor playground**

![Conduktor logo](img/conduktor.png)

--

## Let's provide a playground kafka cluster to every customers

--

<!--.slide: class="center" -->
![Wait what gif](img/what.gif)

--

## Let's provide a ~playground kafka cluster~ to every ~customers~
## Let's provide a **cluster/topic/...** to every **team/user/...**
## Let's provide a <!-- .element: class="fragment" data-fragment-index="1"--> **Kafka ressource**<!-- .element: class="fragment" data-fragment-index="1"--> to every <!-- .element: class="fragment" data-fragment-index="1"--> **Tenant** <!-- .element: class="fragment" data-fragment-index="1"-->

--

<!--.slide: class="center" data-background-opacity="0.9" data-background-image="https://images.unsplash.com/photo-1525119257764-35ca8b725677?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2070&q=80"-->
# **Data isolation**  <!-- .element class="text-shadow"-->

---

<!--.slide: data-state="black-bg" -->
# Solutions 

--

# Always start with *Training*

--

# Then bring *Experience*

--

# Then *build* Documentation

--

<!--.slide: data-state="black-bg" -->
# Then focus on *Nomenclature* / Conventions

--

# Try per *Topic* 

--

# Try Custom *Partitioner*

--

# Or try *Headers* 

--

<!--.slide: data-state="black-bg" -->
# And try *Gitops* / Multiple cluster

--

// TODO problems with multi cluster

--

<!--.slide: data-state="black-bg" -->

# Or try *Common Library*

--

// TODO problems with client app libraries

--

<!--.slide: data-state="black-bg" -->
# Or create *Broker Policy plugins*
# Or <!-- .element: class="fragment" data-fragment-index="1" --> *just* <!-- .element: class="fragment" data-fragment-index="1" --> extend Kafka 

--

// TODO problems with broker plugins

--

<!-- Maybe we don't need this one-->
# Or Suffer with *Status Quo*

--

# All these solutions are *partial*
### (at best)

---

<!--.slide: data-state="black-bg" -->
# So, *what* can we do?

--

# If we can’t *trust* humans
# If we can’t *touch* Kafka

--

# Your *only* option is
# *adding magic*  <!-- .element: class="fragment" -->
# ... between clients and Kafka! <!-- .element: class="fragment" -->

--

# Why?

--

# To add the features Kafka is *currently lacking*

--

# How?

--

# By extending the *Apache Kafka Protocol*
# Enter <!-- .element: class="fragment" data-fragment-index="1" --> https://kafka.apache.org/protocol <!-- .element: class="fragment" data-fragment-index="1" -->

--

# Intercept messages

--

# It's easy
<pre>
    <code class="language-plantuml">
        @startuml
        autonumber
        skinparam handwritten true
        actor Client
        control Kafka
        Client -> Kafka : Send data
        Client -> Kafka : Consume data
        @enduml
    </code>
</pre>

--

# Cluster Metadata
<pre>
    <code class="language-plantuml">
        @startuml
        autonumber
        skinparam handwritten true
        actor Client
        control Broker1
        control Broker2
        control Broker3
        Client -> Broker1 : Hello!
        Broker1 -> Client : Hi there! I'm here with my other broker buddies!
        Client -> Client : Where shall I send this data?
        Client -> Broker3 : Send data
        @enduml
    </code>
</pre>

--

# Let's add a proxy 
### *(yes, you can spare 2 or 3 ms)*
<pre>
    <code class="language-plantuml">
        @startuml
        autonumber
        skinparam handwritten true
        actor Client
        control Proxy
        control Broker1
        control Broker2
        control Broker3
        Client -> Proxy : Hello!
        Proxy -> Broker1 : Hello!
        Broker1 -> Proxy : Hi there! The cluster is broker1:9092, broker2:9092, broker3:9092
        Proxy -> Client : Hi there! The cluster is broker1:9092, broker2:9092, broker3:9092
        Client -> Client : Where shall I send this data?
        Client -> Broker3 : Send data
        Client -> Client : Damned my proxy is not used!
        @enduml
    </code>
</pre>

--

# *Rewriting* metadata
<pre>
    <code class="language-plantuml">
        @startuml
        autonumber
        skinparam handwritten true
        actor Client
        control Proxy
        control Broker1
        control Broker2
        control Broker3
        Client -> Proxy : Hello!
        Proxy -> Broker1 : Hello!
        Broker1 -> Proxy : Hi there! The cluster is broker1:9092, broker2:9092, broker3:9092
        Proxy -> Client : Hi there! The cluster is proxy:6969, proxy:6970, proxy:7071
        Client -> Client : Where shall I send this data?
        Client -> Proxy : Send data to proxy:6971
        Proxy -> Broker3 : Send data to proxy:6971
        Client -> Client : Hourray!
        @enduml
    </code>
</pre>

--

# Does it work in real life ?

--

! Demo multi tenant gateway

--

# *Conduktor playground*
# handles more than 
# 4000 *isolated* tenants
# ... on a *single* cluster!

--

Conduktor gateway
TODO 

--

# Is there *other* such products out there?

--

# GrepLabs <a href="https://github.com/grepplabs/kafka-proxy">➚</a>
# *Envoy <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/listeners/network_filters/kafka_broker_filter">➚</a>* <!-- .element: class="fragment" -->
# Dajudge <a href="https://github.com/dajudge/kafkaproxy">➚</a> <!-- .element: class="fragment" -->
# *EventHub for Kafka* <a href="https://learn.microsoft.com/en-us/azure/event-hubs/azure-event-hubs-kafka-overview">➚</a> <!-- .element: class="fragment" -->

---

<!--.slide: data-state="black-bg" -->
# Now that we're in the protocol ...
# *What else can we do?* <!-- .element: class="fragment" -->

--

# Apply rules

--

# Create topic *policy*
## *naming convention* <!-- .element: class="fragment" -->
## nb partitions <!-- .element: class="fragment" -->
## *min.isr* <!-- .element: class="fragment" -->
## replication factor <!-- .element: class="fragment" -->
## *retention* <!-- .element: class="fragment" -->

--

# Same for *alter* topic!

--

# Produce *checks*
## ack <!-- .element: class="fragment" -->
## *headers* <!-- .element: class="fragment" -->
## compression <!-- .element: class="fragment" -->
## *schema* <!-- .element: class="fragment" -->
## batch.size <!-- .element: class="fragment" -->

--

# Consume *checks*
## limit client <!-- .element: class="fragment" -->
## *limit connections* <!-- .element: class="fragment" -->
## limit offset commit <!-- .element: class="fragment" -->
## *limit join group* <!-- .element: class="fragment" -->

--

# You can apply solutions to your tenants

--

# In *previous* slides

### Data
### Constraints
### Practice enforcement
### Cost

# Each have a solution that could land in a gateway to Kafka

--

<!-- Search how to two columns -->

# Constraints ?

## Data Masking <!-- .element: class="fragment" -->
## *Audit* <!-- .element: class="fragment" -->
## Rbac <!-- .element: class="fragment" -->
## *Encryption* <!-- .element: class="fragment" -->
## Claim Check <!-- .element: class="fragment" -->

--

# Practice enforcement ?

## Safeguard  <!-- .element: class="fragment" -->
## *Transformation* <!-- .element: class="fragment" -->
## Chaos  <!-- .element: class="fragment" -->

--

# Cost ?

## *Virtual Cluster* <!-- .element: class="fragment" -->
## Caching <!-- .element: class="fragment" -->
## Concentration <!-- .element: class="fragment" -->

---

<!--.slide: data-state="black-bg" -->
# Ok, but could we solve our Kafka *problems* ?

--

# *Problem:* Multiple Teams
# *Solution:* Virtualized clusters

--


# *Problem:* Multiple Environments
# *Solution:* virtualized clusters

--

# *Problem:* Multiple Clients
# *Solution:* Safe guard

--

# *Problem:* Multiple Requirements
# *Solution:* Safe guard / Caching / Encryption / Cold-Storage / Custom

--

# *Problem:* Multiple Security Schemes
# *Solution:* One single security plane

--

# *Problem:* Multiple Kafka Providers
# *Solution:* One single data plane

--

# *Problem:* Multiple Versions
# *Solution:* One single data plane

--

# *Problem:* Multiple Monitoring
# *Solution:* One single data plane

--

# *Problem:* Multiple Cost Structure
# *Solution:* One single data plane / Multi-tenancy / Cold Storage / Caching

--

# *Problem:* Multiple Team Maturies
# *Solution:* Multi-tenancy / Safeguard

---

<!--.slide: data-state="black-bg" -->
# T*L*D*R*

--

# Multi-tenancy is *not only* data isolation
# It's the *tip of the iceberg*

--

# Multi-tenancy*solutions* you want to apply to a isolated structure that match your organization 

--

## You could also want 
# *lineage* <!-- .element: class="fragment" -->
# discoverability <!-- .element: class="fragment" -->
# *costs reduction* <!-- .element: class="fragment" -->
# ownership <!-- .element: class="fragment" -->
# *simplicity* <!-- .element: class="fragment" -->
# reversability <!-- .element: class="fragment" -->
# *etc* <!-- .element: class="fragment" -->

--

# Basically,
# you want *and* need *more*!

--

# You are entering ...
# *data-mesh territory!* <!-- .element: class="fragment" -->

--

# Without a kafka gateway you are *doomed to eat dirt*

--

# We open-sourced a gateway you can *extend*

--

# Conduktor Gateway is the *ready to use* version of this talk for $

--

# Gateway enables you to 
# *rethink* your Kafka experience
# github.com/conduktor/conduktor-proxy-demos


---


            </script>
        </section>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script src="./dist/reveal.js"></script>
<script src="./plugin/notes/notes.js"></script>
<script src="./plugin/markdown/markdown.js"></script>
<script src="./plugin/highlight/highlight.js"></script>
<script src="./plugin/reveal.js-plantuml/reveal-plantuml.js"></script>
<script src="./plugin/reveal.js-extrernal-code/externalcode.js"></script>

<script>
Reveal.initialize({
 plantuml: {
      serverPath: 'https://plantuml.com/plantuml/svg/'
  } ,
  hash: true,
  plugins: [Externalcode, RevealMarkdown, RevealHighlight, RevealNotes]
})







</script>

</body>
</html>
